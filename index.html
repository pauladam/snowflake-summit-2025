<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Conference Session Browser</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body { padding: 1rem; }
        .selected { background-color: #e3f2fd; }
        .detail-label { font-weight: 600; }
        .day-buttons .btn, .time-buttons .btn { margin-right: .25rem; margin-bottom: .25rem; }
    </style>
</head>
<body>
<div class="container">
    <header class="bg-primary text-white text-center rounded mb-4 py-3">
        <h1 class="h3 mb-0">Conference Session Browser</h1>
    </header>

    <div class="card mb-3">
        <div class="card-body">
            <div class="row g-2 align-items-center mb-2">
                <div class="col-sm-auto"><label for="searchInput" class="col-form-label">Search:</label></div>
                <div class="col"><input type="text" id="searchInput" class="form-control" placeholder="Search sessions..."></div>
                <div class="col-sm-auto"><button class="btn btn-outline-secondary" onclick="resetFilters()">Reset</button></div>
            </div>
            <div class="row g-2 align-items-center mb-2">
                <div class="col-sm-auto">Filter by day:</div>
                <div class="col day-buttons">
                    <button id="btn-all" class="btn btn-outline-primary day-btn active" onclick="filterByDay('')">All</button>
                    <button id="btn-monday" class="btn btn-outline-primary day-btn" onclick="filterByDay('Monday')">Mon</button>
                    <button id="btn-tuesday" class="btn btn-outline-primary day-btn" onclick="filterByDay('Tuesday')">Tue</button>
                    <button id="btn-wednesday" class="btn btn-outline-primary day-btn" onclick="filterByDay('Wednesday')">Wed</button>
                    <button id="btn-thursday" class="btn btn-outline-primary day-btn" onclick="filterByDay('Thursday')">Thu</button>
                </div>
            </div>
            <div class="row g-2 align-items-center">
                <div class="col-sm-auto">Filter by time:</div>
                <div class="col time-buttons">
                    <button id="btn-time-all" class="btn btn-outline-secondary time-btn active" onclick="filterByTime('')">All Times</button>
                    <button id="btn-time-morning" class="btn btn-outline-secondary time-btn" onclick="filterByTime('morning')">Morning (AM)</button>
                    <button id="btn-time-afternoon" class="btn btn-outline-secondary time-btn" onclick="filterByTime('afternoon')">Afternoon (PM)</button>
                </div>
            </div>
        </div>
    </div>

    <p class="text-center mb-2" id="sessionCount">Loading sessions...</p>
    <div class="table-responsive mb-3">
        <table class="table table-hover">
            <thead class="table-light">
                <tr>
                    <th style="width:50%">Title</th>
                    <th style="width:30%">Date</th>
                    <th style="width:20%">Code</th>
                </tr>
            </thead>
            <tbody id="sessionsTableBody"></tbody>
        </table>
    </div>

    <div class="card" id="sessionDetails">
        <div class="card-body">
            <p class="mb-0">Select a session to view details</p>
        </div>
    </div>
</div>

<script src="sessions.js"></script>
<script>
let allSessions = [];
let filteredSessions = [];
let currentSearchText = '';
let currentDayFilter = '';
let currentTimeFilter = '';
let selectedSessionId = null;

function loadSessions() {
    try {
        allSessions = sessionsData;
        filteredSessions = [...allSessions];
        renderSessions();
        updateSessionCount();
    } catch (error) {
        console.error('Error loading sessions:', error);
        document.getElementById('sessionCount').textContent = 'Error loading sessions';
    }
}

function applyFilters() {
    filteredSessions = allSessions.filter(session => {
        const matchesSearch = !currentSearchText ||
            session.title.toLowerCase().includes(currentSearchText.toLowerCase()) ||
            session.date.toLowerCase().includes(currentSearchText.toLowerCase());
        const matchesDay = !currentDayFilter || session.date.startsWith(currentDayFilter);
        const matchesTime = !currentTimeFilter ||
            (currentTimeFilter === 'morning' && session.date.includes('AM ')) ||
            (currentTimeFilter === 'afternoon' && session.date.includes(' PM '));
        return matchesSearch && matchesDay && matchesTime;
    });
    renderSessions();
    updateSessionCount();
    clearSessionDetails();
}

function renderSessions() {
    const tbody = document.getElementById('sessionsTableBody');
    tbody.innerHTML = '';
    filteredSessions.forEach(session => {
        const row = document.createElement('tr');
        row.onclick = () => selectSession(session);
        row.innerHTML = `
            <td>${escapeHtml(session.title || '')}</td>
            <td>${escapeHtml(session.date || '')}</td>
            <td>${escapeHtml(session.session_code || '')}</td>
        `;
        tbody.appendChild(row);
    });
}

function selectSession(session) {
    document.querySelectorAll('#sessionsTableBody tr').forEach(row => row.classList.remove('selected'));
    event.currentTarget.classList.add('selected');
    selectedSessionId = session.id;
    showSessionDetails(session);
}

function showSessionDetails(session) {
    const detailsDiv = document.getElementById('sessionDetails');
    detailsDiv.innerHTML = `<div class="card-body">
        <h3 class="h5">${escapeHtml(session.title || 'No Title')}</h3>
        <p class="mb-1"><span class="detail-label">Date:</span> ${escapeHtml(session.date || 'N/A')}</p>
        <p class="mb-1"><span class="detail-label">Time:</span> ${escapeHtml(session.time || 'N/A')}</p>
        <p class="mb-1"><span class="detail-label">Session Code:</span> ${escapeHtml(session.session_code || 'N/A')}</p>
        <p class="mb-1"><span class="detail-label">Description:</span> ${escapeHtml(session.description || 'No description available')}</p>
        ${session.ext_partners ? `<p class="mb-1"><span class="detail-label">External Partners:</span> ${escapeHtml(session.ext_partners)}</p>` : ''}
    </div>`;
}

function clearSessionDetails() {
    document.getElementById('sessionDetails').innerHTML = '<div class="card-body"><p class="mb-0">Select a session to view details</p></div>';
    selectedSessionId = null;
}

function filterByDay(day) {
    currentDayFilter = day;
    document.querySelectorAll('.day-btn').forEach(btn => btn.classList.remove('active'));
    if (day === '') {
        document.getElementById('btn-all').classList.add('active');
    } else {
        document.getElementById(`btn-${day.toLowerCase()}`).classList.add('active');
    }
    applyFilters();
}

function filterByTime(time) {
    currentTimeFilter = time;
    document.querySelectorAll('.time-btn').forEach(btn => btn.classList.remove('active'));
    if (time === '') {
        document.getElementById('btn-time-all').classList.add('active');
    } else {
        document.getElementById(`btn-time-${time}`).classList.add('active');
    }
    applyFilters();
}

function resetFilters() {
    currentSearchText = '';
    currentDayFilter = '';
    currentTimeFilter = '';
    document.getElementById('searchInput').value = '';
    document.querySelectorAll('.day-btn').forEach(btn => btn.classList.remove('active'));
    document.getElementById('btn-all').classList.add('active');
    document.querySelectorAll('.time-btn').forEach(btn => btn.classList.remove('active'));
    document.getElementById('btn-time-all').classList.add('active');
    applyFilters();
}

function updateSessionCount() {
    const count = filteredSessions.length;
    const total = allSessions.length;
    document.getElementById('sessionCount').textContent = `Showing ${count} of ${total} sessions`;
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

document.getElementById('searchInput').addEventListener('input', e => {
    currentSearchText = e.target.value.trim();
    applyFilters();
});

document.addEventListener('DOMContentLoaded', loadSessions);
</script>
</body>
</html>
